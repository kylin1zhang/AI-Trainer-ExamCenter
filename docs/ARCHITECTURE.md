# 系统架构说明

> AI Trainer Exam Center - 系统架构文档

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         前端层 (Frontend)                    │
│  Vue 3 + TypeScript + Vite + Pinia + Element Plus          │
│                    http://localhost:3000                     │
└────────────────────┬────────────────────────────────────────┘
                     │ HTTP/HTTPS (REST API)
                     │ JWT Token 认证
┌────────────────────┴────────────────────────────────────────┐
│                      后端层 (Backend)                        │
│     Spring Boot 3.2 + Spring Security + MyBatis Plus        │
│                    http://localhost:8080                     │
└─────────┬───────────────────────┬───────────────────────────┘
          │                       │
          │ JDBC                  │ Redis Protocol
          │                       │
┌─────────┴─────────┐   ┌────────┴────────┐
│   MySQL 8.0+      │   │   Redis 6.0+    │
│   数据持久化       │   │   缓存/会话     │
└───────────────────┘   └─────────────────┘
```

---

## 技术选型

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue 3 | 3.4+ | 渐进式前端框架 |
| TypeScript | 5.3+ | 类型安全的 JavaScript 超集 |
| Vite | 5.0+ | 快速的构建工具 |
| Vue Router | 4.2+ | 路由管理 |
| Pinia | 2.1+ | 状态管理 |
| Element Plus | 2.5+ | UI 组件库 |
| Axios | 1.6+ | HTTP 请求库 |

### 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Java | 17 | 编程语言 |
| Spring Boot | 3.2.0 | 应用框架 |
| Spring Security | - | 安全框架 |
| JWT | 0.12.3 | Token 认证 |
| MyBatis Plus | 3.5.5 | ORM 框架 |
| MySQL | 8.0+ | 关系型数据库 |
| Redis | 6.0+ | 缓存数据库 |
| Knife4j | 4.4.0 | API 文档 |

---

## 系统分层

### 前端分层

```
src/
├── views/              # 视图层（页面组件）
├── components/         # 组件层（可复用组件）
├── layouts/            # 布局层（页面布局）
├── router/             # 路由层（路由配置）
├── store/              # 状态层（Pinia Store）
├── api/                # API 层（接口封装）
├── types/              # 类型层（TypeScript 类型定义）
└── utils/              # 工具层（工具函数）
```

### 后端分层

```
com.zhixuewujie.examcenter
├── controller/         # 控制层（处理 HTTP 请求）
├── service/            # 服务层（业务逻辑）
├── mapper/             # 数据访问层（MyBatis）
├── entity/             # 实体层（数据库实体）
├── dto/                # 数据传输层（请求参数）
├── vo/                 # 视图对象层（响应数据）
├── config/             # 配置层（各种配置）
├── security/           # 安全层（认证授权）
├── common/             # 公共层（通用类）
├── exception/          # 异常层（异常处理）
└── util/               # 工具层（工具类）
```

---

## 数据流向

### 用户请求流程

```
1. 用户操作
   ↓
2. 前端 View 触发事件
   ↓
3. 调用 API 接口（Axios）
   ↓
4. 添加 JWT Token 到请求头
   ↓
5. 发送 HTTP 请求到后端
   ↓
6. 后端 Controller 接收请求
   ↓
7. JWT 过滤器验证 Token
   ↓
8. Controller 调用 Service
   ↓
9. Service 处理业务逻辑
   ↓
10. Mapper 查询数据库
   ↓
11. 返回数据到 Service
   ↓
12. Service 封装成 VO
   ↓
13. Controller 返回统一响应（Result）
   ↓
14. 前端接收响应数据
   ↓
15. 更新 Store 状态（如需要）
   ↓
16. 更新 View 视图
```

---

## 核心模块

### 1. 认证授权模块

**功能：**
- 用户注册/登录
- JWT Token 生成和验证
- Token 刷新机制
- 登出清除会话

**技术实现：**
- Spring Security 配置安全策略
- JwtTokenProvider 生成和解析 Token
- JwtAuthenticationFilter 拦截请求验证 Token
- Redis 存储 Token 黑名单（登出后失效）

**流程图：**

```
用户登录请求
    ↓
验证用户名密码
    ↓
生成 JWT Token
    ↓
Token 存入 Redis（有效期 7 天）
    ↓
返回 Token 给前端
    ↓
前端存储 Token（localStorage）
    ↓
每次请求携带 Token
    ↓
后端验证 Token 有效性
    ↓
解析 Token 获取用户信息
    ↓
执行业务逻辑
```

### 2. 题库管理模块

**功能：**
- 题库列表展示
- 题库详情查询
- 题库统计信息

**数据结构：**

```sql
tb_question_bank
├── id              # 题库ID
├── name            # 题库名称
├── description     # 题库描述
├── cover_image     # 封面图
├── question_count  # 题目总数
└── ...
```

### 3. 题目练习模块

**功能：**
- 顺序练习
- 随机练习
- 题型练习
- 易错题练习

**数据结构：**

```sql
tb_question
├── id              # 题目ID
├── bank_id         # 所属题库
├── question_type   # 题目类型
├── content         # 题干
├── options         # 选项（JSON）
├── correct_answer  # 正确答案
├── explanation     # 答案解析
└── ...
```

### 4. 答题记录模块

**功能：**
- 记录用户答题历史
- 统计正确率
- 生成错题集
- 易错题分析

**数据结构：**

```sql
tb_user_answer
├── id              # 记录ID
├── user_id         # 用户ID
├── question_id     # 题目ID
├── user_answer     # 用户答案
├── is_correct      # 是否正确
├── practice_mode   # 练习模式
└── ...
```

### 5. 模拟考试模块

**功能：**
- 创建模拟考试（随机抽题）
- 考试计时
- 提交考试
- 评分和错题分析

**数据结构：**

```sql
tb_exam
├── id              # 考试ID
├── user_id         # 用户ID
├── bank_id         # 题库ID
├── question_ids    # 题目列表（JSON）
├── duration        # 考试时长
├── score           # 得分
├── status          # 考试状态
└── ...
```

---

## 数据库设计

### ER 图

```
┌──────────────┐           ┌──────────────────┐
│   tb_user    │───────────│ tb_question_bank │
│              │ 1       * │                  │
└──────┬───────┘           └────────┬─────────┘
       │                            │
       │ 1                          │ 1
       │                            │
       │ *                          │ *
┌──────┴────────┐           ┌───────┴────────┐
│ tb_user_answer│           │  tb_question   │
└───────────────┘           └────────────────┘
       │
       │ *
       │
       │ 1
┌──────┴────────┐
│ tb_user_favorite
└───────────────┘
       │
       │ *
       │
       │ 1
┌──────┴────────┐
│ tb_user_note  │
└───────────────┘
```

### 表关系

- **用户 ←→ 题库**: 多对多（通过答题记录关联）
- **用户 ←→ 题目**: 多对多（通过答题记录、收藏、笔记关联）
- **题库 ←→ 题目**: 一对多
- **用户 ←→ 答题记录**: 一对多
- **用户 ←→ 收藏**: 一对多
- **用户 ←→ 笔记**: 一对多
- **用户 ←→ 考试**: 一对多

---

## 安全设计

### 1. 认证安全

- ✅ 密码加密存储（BCrypt）
- ✅ JWT Token 认证
- ✅ Token 过期机制（7天）
- ✅ Token 刷新机制
- ✅ 登出清除 Token（Redis 黑名单）

### 2. 授权安全

- ✅ 基于角色的访问控制（RBAC）
- ✅ 接口权限校验
- ✅ 数据权限隔离（用户只能访问自己的数据）

### 3. 数据安全

- ✅ SQL 注入防护（MyBatis 参数绑定）
- ✅ XSS 防护（前端转义）
- ✅ CSRF 防护（Token 验证）
- ✅ 敏感数据加密

### 4. 接口安全

- ✅ 接口限流（防止暴力攻击）
- ✅ 请求签名验证
- ✅ HTTPS 传输加密
- ✅ CORS 跨域配置

---

## 性能优化

### 1. 前端优化

- ✅ 路由懒加载
- ✅ 组件按需引入
- ✅ 图片懒加载
- ✅ 静态资源 CDN
- ✅ 代码分割（Code Splitting）
- ✅ Gzip 压缩

### 2. 后端优化

- ✅ Redis 缓存
  - 题目详情缓存（1小时）
  - 题库列表缓存（10分钟）
  - 用户信息缓存（30分钟）
- ✅ 数据库索引优化
- ✅ SQL 查询优化
- ✅ 连接池配置
- ✅ 异步处理（答题记录保存）

### 3. 数据库优化

- ✅ 合理的索引设计
- ✅ 分页查询
- ✅ 避免 N+1 查询
- ✅ 数据库读写分离（如需要）

---

## 扩展性设计

### 1. 多题库支持

- 所有表通过 `bank_id` 关联
- 新增题库只需插入 `tb_question_bank` 记录
- 前端自动展示所有题库

### 2. 题型扩展

当前支持：
- 单选题（SINGLE_CHOICE）
- 多选题（MULTIPLE_CHOICE）
- 判断题（TRUE_FALSE）

未来可扩展：
- 填空题（FILL_BLANK）
- 简答题（SHORT_ANSWER）
- 论述题（ESSAY）
- 代码题（CODE）

### 3. 功能扩展

- 在线考试监考
- 智能组卷
- 学习路径推荐
- 社区讨论功能
- 题目纠错功能
- 学习报告统计

---

## 部署架构

### 单机部署

```
┌─────────────────────────────────────┐
│           Nginx (80/443)            │
│  ├─ 静态文件 (Frontend)              │
│  └─ 反向代理 (Backend API)           │
└───────────┬─────────────────────────┘
            │
┌───────────┴─────────────────────────┐
│     Spring Boot (8080)              │
│     ├─ API 服务                     │
│     └─ 业务逻辑                     │
└───────────┬─────────────────────────┘
            │
    ┌───────┴────────┐
    │                │
┌───┴────┐    ┌──────┴─────┐
│ MySQL  │    │   Redis    │
└────────┘    └────────────┘
```

### 分布式部署（未来）

```
           ┌─────────────┐
           │  Nginx LB   │
           └──────┬──────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
┌───┴───┐    ┌────┴────┐   ┌────┴────┐
│ Web 1 │    │  Web 2  │   │  Web 3  │
└───────┘    └─────────┘   └─────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
┌───┴───┐    ┌────┴────┐   ┌────┴────┐
│ API 1 │    │  API 2  │   │  API 3  │
└───────┘    └─────────┘   └─────────┘
                  │
    ┌─────────────┼─────────────┐
    │             │             │
┌───┴─────┐  ┌────┴────┐   ┌────┴────┐
│ MySQL   │  │  Redis  │   │  MQ     │
│ Master  │  │ Cluster │   │ Queue   │
│ + Slave │  │         │   │         │
└─────────┘  └─────────┘   └─────────┘
```

---

## 监控与日志

### 日志系统

- **应用日志**: Logback 输出到文件
- **访问日志**: Nginx 访问日志
- **错误日志**: 异常堆栈记录
- **审计日志**: 用户操作记录

### 监控指标

- **系统监控**: CPU、内存、磁盘、网络
- **应用监控**: QPS、响应时间、错误率
- **数据库监控**: 慢查询、连接数、死锁
- **缓存监控**: 命中率、内存使用

### 告警机制

- 服务宕机告警
- 错误率过高告警
- 响应时间过长告警
- 磁盘空间不足告警

---

## 相关文档

- [快速启动](./QUICKSTART.md)
- [API 文档](./API.md)
- [部署指南](./DEPLOYMENT.md)
- [贡献指南](./CONTRIBUTING.md)

---

Copyright © 2025 上海智学无界教育科技有限公司


